#context("correctness of TREC")
library(TREC)

test_that("TREC result is exactly the way we construct this algorithm", {
data<-read.table(file = "data_mix_gaussian.txt")
m<-100
n<-3*m
####### Generating clusters via K means with 10 random starts #######
#
#
# 1) k =3
#
#
######

#random starts
nRestarts <- 10
nMethods <- nRestarts
k <- 3
seeds <- c(220478, 990173, 616158, 234877, 117668,
           191320, 238344, 945282, 609899, 122166)

#
#  Get the clusterings from k-means
clustering <- array(0, dim=c(n,nMethods))
for (i in 1:nMethods) {
  set.seed(seeds[i])
  kMean <- kmeans(data,centers=k,iter.max=15)
  clustering[,i] <- kMean$cluster
}
branchComponent <- TRECgetComponentsfromClustering(clustering)
expected <- matrix(data = c(2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
                            ,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
                            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
                            ,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
                            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
                            ,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
                            1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
                            ,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
                            2,2,2,2,2,2,2,2,3,4,4,4,3,3,3,3,4,3,5,4,5,4,3,4,4,3,4,3,3,3,3,4,4,4,4,4,4,4,4,4,4,3,4,3,4,5,4,4,4,3,5,3,4,4,3,4,4,3,3,3,4,3
                            ,3,4,5,4,4,4,4,4,3,4,3,4,4,3,4,3,3,4,4,3,3,3,5,4,4,3,3,4,3,3,4,4,3,4,3,4,3,3,4,4,3,4,4,4,3,3),nrow = 300, ncol = 2)
expect_equal(branchComponent,expected)
####### Generating clusters via K means with 10 random starts #######
#
#
# 2) k = 16
#
#
######

#random starts
nRestarts <- 10
nMethods <- nRestarts
k <- 16
seeds <- c(220478, 990173, 616158, 234877, 117668,
           191320, 238344, 945282, 609899, 122166)

clustering <- array(0, dim=c(n,nMethods))
for (i in 1:nMethods) {
  set.seed(seeds[i])
  kMean <- kmeans(data,centers=k,iter.max=15)
  clustering[,i] <- kMean$cluster
}

branchComponent <- TRECgetComponentsfromClustering(clustering)
expected<-matrix(data = c(2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
                          ,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
                          2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
                          ,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
                          1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,6,6,6,6,6,6
                          ,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
                          6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1,5,5,5,5,5,1,5,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,5,5,5,5
                          ,5,5,5,5,5,5,5,5,5,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,5,5,5,5,5,1,5,5,5,1,5,5,5,5,5,5,5,5,5,1,5,5,5,5,5,1,5,5,5,5,5,5,5,
                          5,5,5,5,5,5,5,5,2,3,3,3,2,3,2,4,3,2,3,2,3,3,4,3,2,3,2,4,4,4,4,2,3,3,3,2,3,3,3,3,3,2,2,3,3,2,3,3,3,4,2,3,3,3,4,3,3,2,4,2,3,2
                          ,3,3,2,3,3,3,3,3,2,3,2,3,3,3,3,4,2,3,3,4,3,4,2,3,3,3,4,2,4,4,3,2,3,3,4,2,3,3,2,2,4,2,3,2,3,2,7,13,13,13,7,13,13,13,13,13,13
                          ,13,13,13,13,13,13,13,13,7,7,13,13,13,13,13,13,7,13,13,7,13,13,13,13,13,13,13,13,7,13,13,7,13,13,7,13,13,13,13,13,13,7,13,13,
                          13,13,13,7,7,13,13,13,7,13,7,13,13,13,13,13,7,7,13,13,13,0,13,7,13,13,7,13,13,13,0,13,13,13,13,13,7,13,13,7,13,13,13,13,13,
                          4,12,12,12,12,1,4,12,4,12,12,12,1,12,12,12,12,12,12,12,8,1,12,12,12,12,4,12,1,8,12,12,12,1,8,12,12,12,12,12,4,4,0,12,8,12
                          ,8,8,8,12,12,12,1,8,12,12,8,8,4,12,8,8,12,1,4,12,1,12,4,12,12,1,8,12,12,12,8,1,4,8,8,12,12,1,4,12,12,12,12,12,12,12,12,12,
                          12,8,12,12,8,12,5,2,9,10,5,9,5,11,9,5,9,6,9,9,11,10,6,9,6,11,11,3,11,6,10,10,10,6,9,10,9,10,10,5,6,9,9,6,10,9,10,11,6,9,10,10,
                          11,10,9,5,11,5,10,5,9,10,6,10,10,10,10,10,5,9,5,10,10,9,10,11,5,10,9,11,9,11,6,2,2,9,11,6,11,3,10,6,9,10,11,6,9,9,6,0,11,
                          6,10,6,9,5),nrow=300,ncol=3)
expect_equal(branchComponent[,1:3],expected)
####### Combining K means (k=2) with Gaussian model based #######
#
######
nMethods <- 2
clustering <- array(0, dim=c(n, nMethods))
k <- 2
clustering[,1] <- kmeans(data,centers=k,iter.max=15)$cluster
require(mclust)
clustering[,2] <- Mclust(data)$classification

branchComponent <- TRECgetComponentsfromClustering(clustering)
expected <- matrix(data = c(2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
                            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
                            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
                            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
                            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
                            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
                            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),nrow = 300,ncol = 2)
expect_equal(branchComponent,expected)
})

